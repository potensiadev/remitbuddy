# 프록시 시스템 설정 가이드

## 개요
이 시스템은 대용량 트래픽 환경에서 IP 로테이션을 통한 웹 스크래핑 안정화를 제공합니다.

## 주요 기능

### 1. IP 로테이션 & 프록시 풀 관리
- **동적 프록시 할당**: 각 요청마다 최적의 프록시 자동 선택
- **로드 밸런싱**: 프록시별 부하 분산
- **헬스 체크**: 프록시 상태 자동 모니터링

### 2. 레이트 리미팅 & 차단 방지
- **프록시별 요청 제한**: 분당 요청 수 제한
- **동시 연결 관리**: 프록시당 최대 동시 연결 수
- **백오프 전략**: 실패한 프록시 임시 차단

### 3. 지능형 요청 분산
- **실패율 기반 우선순위**: 성공률 높은 프록시 우선 사용
- **부하 분산**: 동시 연결 수 기반 분산
- **자동 복구**: 차단된 프록시 자동 복구

## 설정 방법

### 1. 프록시 설정 파일 (`proxy_config.json`)
```json
{
  "proxies": [
    {
      "ip": "proxy1.example.com",
      "port": 8080,
      "username": "user1",
      "password": "pass1",
      "protocol": "http",
      "max_concurrent": 3,
      "rate_limit_per_minute": 20
    },
    {
      "ip": "proxy2.example.com",
      "port": 8080,
      "username": "user2",
      "password": "pass2",
      "protocol": "http",
      "max_concurrent": 3,
      "rate_limit_per_minute": 20
    }
  ]
}
```

### 2. 환경 변수 설정 (선택사항)
```bash
export PROXY_1="proxy1.example.com:8080:user1:pass1"
export PROXY_2="proxy2.example.com:8080:user2:pass2"
export PROXY_3="proxy3.example.com:8080:user3:pass3"
```

### 3. 프록시 제공업체 예시
- **Bright Data** (구 Luminati): 높은 성공률, 다양한 지역
- **Oxylabs**: 안정적인 데이터센터 프록시
- **Smartproxy**: 주거용 프록시 풀
- **ProxyMesh**: 저렴한 데이터센터 프록시

## 운영 모니터링

### 1. 프록시 상태 확인
```bash
curl http://localhost:8000/admin/proxy/stats
```

### 2. 헬스 체크 실행
```bash
curl -X POST http://localhost:8000/admin/proxy/health-check
```

### 3. 개별 프록시 테스트
```bash
curl http://localhost:8000/admin/proxy/test/proxy1.example.com
```

## 법적 고려사항

### 1. 로봇 배제 표준 준수
- robots.txt 파일 확인
- 적절한 크롤링 지연 시간 설정
- 사이트 이용약관 검토

### 2. 레이트 리미팅
- 분당 요청 수 제한 (기본: 20개)
- 동시 연결 수 제한 (기본: 3개)
- 실패 시 백오프 전략

### 3. 모니터링 및 로깅
- 모든 요청 로그 기록
- 에러율 모니터링
- 프록시 사용 통계

## 성능 최적화

### 1. 프록시 풀 크기
- **최소**: 5개 프록시
- **권장**: 10-20개 프록시
- **대규모**: 50개 이상 프록시

### 2. 지역별 프록시 분산
- 대상 사이트와 가까운 지역 프록시 사용
- 지연 시간 최소화
- 지역별 IP 차단 회피

### 3. 프록시 유형별 특성
- **데이터센터**: 빠른 속도, 저렴한 비용
- **주거용**: 높은 성공률, 비싼 비용
- **모바일**: 최고 성공률, 최고 비용

## 장애 대응

### 1. 프록시 차단 시
- 자동 다른 프록시로 전환
- 차단된 프록시 5분간 비활성화
- 실패율 50% 초과 시 임시 차단

### 2. 전체 프록시 실패 시
- 직접 연결로 폴백
- 에러 로그 기록
- 관리자 알림

### 3. 성능 저하 시
- 프록시 헬스 체크 실행
- 느린 프록시 제거
- 프록시 풀 재구성

## 보안 고려사항

### 1. 인증 정보 보호
- 설정 파일 암호화
- 환경 변수 사용
- 접근 권한 제한

### 2. 로그 보안
- 민감한 정보 마스킹
- 로그 파일 접근 제한
- 정기적인 로그 순환

### 3. 네트워크 보안
- HTTPS 사용
- 프록시 연결 검증
- 악성 프록시 차단

---

## 실제 배포 전 체크리스트

- [ ] 실제 프록시 업체 계정 생성
- [ ] 프록시 설정 파일 업데이트
- [ ] 헬스 체크 테스트 실행
- [ ] 모니터링 대시보드 설정
- [ ] 로그 시스템 구성
- [ ] 알림 시스템 설정
- [ ] 법적 검토 완료
- [ ] 성능 테스트 실행